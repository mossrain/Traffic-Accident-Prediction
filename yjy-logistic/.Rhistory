writeLines('PATH="${RTOOLS40_HOME}\\usr\\bin;${PATH}"', con = "~/.Renviron")
Sys.which("make")
getOption("repos")
getOption("BioC_mirror")
getOption("repos")
getOption("BioC_mirror")
getOption("repos")
getOption("BioC_mirror")
.libPaths()
installed.packages()
library(ggplot2)
install.packages("tidyverse")
library(tidyverse)
library(ggplot2)
mpg
str(mpg)
ggplot(mpg,aes(x=displ,y=hwy))+geom_point()
library(ggplot2)
mpg
ggplot(mpg,aes(x=displ,y=hwy))+geom_point()
ggplot(mpg,aes(displ,hwy))+geom_point(position = "jitter")
ggplot(mpg,aes(displ,hwy))+geom_point(aes(color=class))
ggplot(mpg,aes(displ,hwy))+geom_point(color="blue")
ggplot(mpg,aes(displ,hwy))+geom_point(aes(color=class,alpha=class))
ggplot(mpg,aes(displ,hwy))+geom_point(aes(color=class,shape=class))
ggplot(mpg,aes(displ,hwy))+geom_point(aes(color=class))+facet_wrap(~class,nrow=2)
ggplot(mpg,aes(displ,hwy))+geom_smooth(aes(linetype=drv,color=drv))
ggplot(mpg,aes(displ,hwy))+geom_point()+geom_smooth()
ggplot(mpg,aes(displ,hwy))+geom_point()+geom_smooth(method="loess",span=0.2)
ggplot(mpg,aes(displ,hwy))+geom_point()+geom_smooth(method="loess",span=1)
ggplot(mpg,aes(x=cut,fill=cut))+geom_bar()
ggplot(mpg,aes(displ,hwy))+geom_bar()
ggplot(mpg,aes(displ))+geom_bar()
ggplot(mpg,aes(x=displ,fill=displ))+geom_bar()
ggplot(mpg,aes(x=displ,fill=hwy))+geom_bar()
summary(mpg)
ggplot(mpg,aes(manufacturer,fill=manufacturer))+geom_bar()
ggplot(mpg,aes(hwy))+geom_histogram()
ggplot(mpg,aes(displ,hwy))+geom_point()+facet_wrap(~year)
ggplot(mpg,aes(x=displ,y=hwy))+geom_point()+geom_smooth()
ggplot(mpg,aes(displ,hwy))+geom_point()+facet_wrap(~year)
table(mpg$class)
pie(table(mpg$class))
ggplot(mpg,aes(x=displ,y=hwy,color=class))+geom_point()
ggplot(mpg,aes(displ,hwy))+geom_point()+facet_wrap(~class)
ggplot(mpg,aes(x=displ,y=hwy,color=trans))+geom_point()
ggplot(mpg,aes(trans,hwy))+geom_boxplot()
ggplot(mpg,aes(drv,hwy))+geom_point()
ggplot(mpg,aes(drv,hwy))+geom_boxplot()
ggplot(mpg,aes(hwy))+geom_freqpoly(binwidth = 1)
# 1、病例为车祸发生那一小时，对照为车祸发生那天其他时间的车流量------
df_crash <- read.csv("crash_data -.csv") %>%
mutate(
Time=as.numeric(str_split(starttime,":",simplify = T)[,1]),
Key=str_c(segment,Time,sep="-"),
crash=1
) %>%
select(-2,-3,-Time)
df_traffic <- read.csv("traffic_data .csv") %>%
mutate(
Time=as.numeric(str_split(time,":",simplify = T)[,1]),
Key=str_c(segment,Time,sep="-")
) %>%
filter(segment %in% df_crash$segment) %>%
group_by(Key) %>%
summarise(
speed=mean(speed,na.rm = T),
flow=mean(flow,na.rm=T),
segment=mean(segment)
)
install.packages("tidyverse")library(tidyverse)
install.packages("tidyverse")
library(survival)
library(tidyverse)
library(lubridate)
library(pROC)#ROC曲线函数
# 1、病例为车祸发生那一小时，对照为车祸发生那天其他时间的车流量------
df_crash <- read.csv("crash_data -.csv") %>%
mutate(
Time=as.numeric(str_split(starttime,":",simplify = T)[,1]),
Key=str_c(segment,Time,sep="-"),
crash=1
) %>%
select(-2,-3,-Time)
install.packages("lubridate")
install.packages("lubridate")
library(survival)
library(tidyverse)
library(lubridate)
library(pROC)#ROC曲线函数
# 1、病例为车祸发生那一小时，对照为车祸发生那天其他时间的车流量------
df_crash <- read.csv("crash_data -.csv") %>%
mutate(
Time=as.numeric(str_split(starttime,":",simplify = T)[,1]),
Key=str_c(segment,Time,sep="-"),
crash=1
) %>%
select(-2,-3,-Time)
df_traffic <- read.csv("traffic_data .csv") %>%
mutate(
Time=as.numeric(str_split(time,":",simplify = T)[,1]),
Key=str_c(segment,Time,sep="-")
) %>%
filter(segment %in% df_crash$segment) %>%
group_by(Key) %>%
summarise(
speed=mean(speed,na.rm = T),
flow=mean(flow,na.rm=T),
segment=mean(segment)
)
df_all <- df_traffic %>% left_join(df_crash) %>%
mutate(crash=replace_na(crash,0))
# 2、将 speed,flow中的大于media+3倍IQR的转化为media+3倍IQR---------
df_all$speed[df_all$speed>median(df_all$speed)+3*IQR(df_all$speed)] <- median(df_all$speed)+3*IQR(df_all$speed)
df_all$flow[df_all$flow>median(df_all$flow)+3*IQR(df_all$flow)] <- median(df_all$flow)+3*IQR(df_all$flow)
setwd("E:\\PROGRAM\\R")
library(survival)
library(tidyverse)
library(lubridate)
library(pROC)#ROC曲线函数
# 1、病例为车祸发生那一小时，对照为车祸发生那天其他时间的车流量------
df_crash <- read.csv("crash_data -.csv") %>%
mutate(
Time=as.numeric(str_split(starttime,":",simplify = T)[,1]),
Key=str_c(segment,Time,sep="-"),
crash=1
) %>%
select(-2,-3,-Time)
df_traffic <- read.csv("traffic_data .csv") %>%
mutate(
Time=as.numeric(str_split(time,":",simplify = T)[,1]),
Key=str_c(segment,Time,sep="-")
) %>%
filter(segment %in% df_crash$segment) %>%
group_by(Key) %>%
summarise(
speed=mean(speed,na.rm = T),
flow=mean(flow,na.rm=T),
segment=mean(segment)
)
df_all <- df_traffic %>% left_join(df_crash) %>%
mutate(crash=replace_na(crash,0))
# 2、将 speed,flow中的大于media+3倍IQR的转化为media+3倍IQR---------
df_all$speed[df_all$speed>median(df_all$speed)+3*IQR(df_all$speed)] <- median(df_all$speed)+3*IQR(df_all$speed)
df_all$flow[df_all$flow>median(df_all$flow)+3*IQR(df_all$flow)] <- median(df_all$flow)+3*IQR(df_all$flow)
# 3、将数据拆分为训练集和测试集,3/7分---------
num <- sample(unique(df_all$segment),length(unique(df_all$segment))*0.7,replace = F)
df_train <- df_all[df_all$segment%in%num,]
df_test <- df_all[!df_all$segment%in%num,]
# 4、在训练集上构建模型---------------
clg <- clogit(crash~speed+flow+strata(segment),data = df_all)
# 5、在测试集上验证模型-------------
df_test %>%
filter(crash==0) %>%
group_by(segment) %>%
summarise(
m_flow=mean(flow),
m_speed=mean(speed)
) %>%
ungroup() %>%
right_join(df_test) %>%
mutate(
flow1=flow-m_flow,
speed1=speed-m_speed
)->df_test2
df_test2$predoct=exp(-0.82887*df_test2$speed1+0.006935*df_test2$flow1)# 根据公式6计算OR值
# 6、模型性能-------------
HH <- roc(df_test2$crash,df_test2$predoct) # 绘制ROC曲线
plot(HH)
setwd("E:\\PROGRAM\\R")
library(survival)
library(tidyverse)
library(lubridate)
library(pROC)#ROC曲线函数
# 1、病例为车祸发生那一小时，对照为车祸发生那天其他时间的车流量------
df_crash <- read.csv("crash_data -.csv") %>%
mutate(
Time=as.numeric(str_split(starttime,":",simplify = T)[,1]),
Key=str_c(segment,Time,sep="-"),
crash=1
) %>%
select(-2,-3,-Time)
df_traffic <- read.csv("traffic_data .csv") %>%
mutate(
Time=as.numeric(str_split(time,":",simplify = T)[,1]),
Key=str_c(segment,Time,sep="-")
) %>%
filter(segment %in% df_crash$segment) %>%
group_by(Key) %>%
summarise(
speed=mean(speed,na.rm = T),
flow=mean(flow,na.rm=T),
segment=mean(segment)
)
df_all <- df_traffic %>% left_join(df_crash) %>%
mutate(crash=replace_na(crash,0))
# 2、将 speed,flow中的大于media+3倍IQR的转化为media+3倍IQR---------
df_all$speed[df_all$speed>median(df_all$speed)+3*IQR(df_all$speed)] <- median(df_all$speed)+3*IQR(df_all$speed)
df_all$flow[df_all$flow>median(df_all$flow)+3*IQR(df_all$flow)] <- median(df_all$flow)+3*IQR(df_all$flow)
# 3、将数据拆分为训练集和测试集,3/7分---------
set.seed(5210)
num <- sample(unique(df_all$segment),length(unique(df_all$segment))*0.7,replace = F)
df_train <- df_all[df_all$segment%in%num,]
df_test <- df_all[!df_all$segment%in%num,]
# 4、在训练集上构建模型---------------
clg <- clogit(crash~speed+flow+strata(segment),data = df_train )
summary(clg)
# 5、在测试集上验证模型-------------
df_test %>%
filter(crash==0) %>%
group_by(segment) %>%
summarise(
m_flow=mean(flow),
m_speed=mean(speed)
) %>%
ungroup() %>%
right_join(df_test) %>%
mutate(
flow1=flow-m_flow,
speed1=speed-m_speed
)->df_test2
df_test2$predoct=exp(-0.067617*df_test2$speed1+0.008844*df_test2$flow1)# 根据公式6计算OR值
# 6、模型性能-------------
HH <- roc(df_test2$crash,df_test2$predoct) # 绘制ROC曲线
plot(HH)
HH$auc
# 1、病例为车祸发生那一小时，对照为车祸发生那天其他时间的车流量------
df_crash <- read.csv("crash_data .csv") %>%
mutate(
Time=as.numeric(str_split(starttime,":",simplify = T)[,1]),
Key=str_c(segment,Time,sep="-"),
crash=1
) %>%
select(-2,-3,-Time)
setwd("E:\\PROGRAM\\R")
library(survival)
library(tidyverse)
library(lubridate)
library(pROC)#ROC曲线函数
# 1、病例为车祸发生那一小时，对照为车祸发生那天其他时间的车流量------
df_crash <- read.csv("crash_data .csv") %>%
mutate(
Time=as.numeric(str_split(starttime,":",simplify = T)[,1]),
Key=str_c(segment,Time,sep="-"),
crash=1
) %>%
select(-2,-3,-Time)
df_traffic <- read.csv("traffic_data .csv") %>%
mutate(
Time=as.numeric(str_split(time,":",simplify = T)[,1]),
) %>%
filter(segment %in% df_crash$segment) %>%
group_by(Key) %>%
summarise(
speed=mean(speed,na.rm = T),
flow=mean(flow,na.rm=T),
segment=mean(segment)
)
setwd("E:\\PROGRAM\\R")
library(survival)
library(tidyverse)
library(lubridate)
library(pROC)#ROC曲线函数
# 1、病例为车祸发生那一小时，对照为车祸发生那天其他时间的车流量------
df_crash <- read.csv("crash_data.csv") %>%
mutate(
Time=as.numeric(str_split(starttime,":",simplify = T)[,1]),
Key=str_c(segment,Time,sep="-"),
crash=1
) %>%
select(-2,-3,-Time)
df_traffic <- read.csv("traffic_data.csv") %>%
mutate(
Time=as.numeric(str_split(time,":",simplify = T)[,1]),
) %>%
filter(segment %in% df_crash$segment) %>%
group_by(Key) %>%
summarise(
speed=mean(speed,na.rm = T),
flow=mean(flow,na.rm=T),
segment=mean(segment)
)
df_all$flow[df_all$flow>median(df_all$flow)+3*IQR(df_all$flow)] <- median(df_all$flow)+3*IQR(df_all$flow)
# 3、将数据拆分为训练集和测试集,3/7分---------
set.seed(5210)
num <- sample(unique(df_all$segment),length(unique(df_all$segment))*0.7,replace = F)
df_train <- df_all[df_all$segment%in%num,]
df_test <- df_all[!df_all$segment%in%num,]
# 4、在训练集上构建模型---------------
clg <- clogit(crash~speed+flow+strata(segment),data = df_train )
summary(clg)
# 5、在测试集上验证模型-------------
df_test %>%
filter(crash==0) %>%
group_by(segment) %>%
summarise(
m_flow=mean(flow),
m_speed=mean(speed)
) %>%
ungroup() %>%
right_join(df_test) %>%
mutate(
flow1=flow-m_flow,
speed1=speed-m_speed
)->df_test2
df_test2$predoct=exp(-0.067617*df_test2$speed1+0.008844*df_test2$flow1)# 根据公式6计算OR值
# 6、模型性能-------------
HH <- roc(df_test2$crash,df_test2$predoct) # 绘制ROC曲线
plot(HH)
HH$auc
setwd("E:\\PROGRAM\\R")
library(survival)
library(tidyverse)
library(lubridate)
library(pROC)#ROC曲线函数
# 1、病例为车祸发生那一小时，对照为车祸发生那天其他时间的车流量------
df_crash <- read.csv("crash_data.csv") %>%
mutate(
Time=as.numeric(str_split(starttime,":",simplify = T)[,1]),
Key=str_c(segment,Time,sep="-"),
crash=1
) %>%
select(-2,-3,-Time)
df_traffic <- read.csv("traffic_data.csv") %>%
mutate(
Time=as.numeric(str_split(time,":",simplify = T)[,1]),
) %>%
filter(segment %in% df_crash$segment) %>%
group_by(Key) %>%
summarise(
speed=mean(speed,na.rm = T),
flow=mean(flow,na.rm=T),
segment=mean(segment)
)
setwd("E:\\PROGRAM\\R")
library(survival)
library(tidyverse)
library(lubridate)
library(pROC)#ROC曲线函数
# 1、病例为车祸发生那一小时，对照为车祸发生那天其他时间的车流量------
df_crash <- read.csv("crash_data.csv") %>%
mutate(
Time=as.numeric(str_split(starttime,":",simplify = T)[,1]),
Key=str_c(segment,Time,sep="-"),
crash=1
) %>%
select(-2,-3,-Time)
df_traffic <- read.csv("traffic_data.csv") %>%
mutate(
Time=as.numeric(str_split(time,":",simplify = T)[,1]),
Key=str_c(segment,Time,sep="-")
) %>%
filter(segment %in% df_crash$segment) %>%
group_by(Key) %>%
summarise(
speed=mean(speed,na.rm = T),
flow=mean(flow,na.rm=T),
segment=mean(segment)
)
df_all <- df_traffic %>% left_join(df_crash) %>%
mutate(crash=replace_na(crash,0))
# 2、将 speed,flow中的大于media+3倍IQR的转化为media+3倍IQR---------
df_all$speed[df_all$speed>median(df_all$speed)+3*IQR(df_all$speed)] <- median(df_all$speed)+3*IQR(df_all$speed)
df_all$flow[df_all$flow>median(df_all$flow)+3*IQR(df_all$flow)] <- median(df_all$flow)+3*IQR(df_all$flow)
# 3、将数据拆分为训练集和测试集,3/7分---------
set.seed(5210)
num <- sample(unique(df_all$segment),length(unique(df_all$segment))*0.7,replace = F)
df_train <- df_all[df_all$segment%in%num,]
df_test <- df_all[!df_all$segment%in%num,]
# 4、在训练集上构建模型---------------
clg <- clogit(crash~speed+flow+strata(segment),data = df_train )
summary(clg)
# 5、在测试集上验证模型-------------
df_test %>%
filter(crash==0) %>%
group_by(segment) %>%
summarise(
m_flow=mean(flow),
m_speed=mean(speed)
) %>%
ungroup() %>%
right_join(df_test) %>%
mutate(
flow1=flow-m_flow,
speed1=speed-m_speed
)->df_test2
df_test2$predoct=exp(-0.067617*df_test2$speed1+0.008844*df_test2$flow1)# 根据公式6计算OR值
# 6、模型性能-------------
HH <- roc(df_test2$crash,df_test2$predoct) # 绘制ROC曲线
plot(HH)
HH$auc
